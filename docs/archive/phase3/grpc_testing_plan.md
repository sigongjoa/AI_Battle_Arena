# Phase 3: gRPC 통합 테스트 계획 및 성공 기준

## 1. 테스트 목표

gRPC 기반의 실시간 통신 채널이 기존 WebSocket을 대체하여 안정적이고 효율적으로 작동하는지 검증합니다. 특히, 게임 상태 및 강화학습 메트릭이 백엔드에서 프론트엔드로 지연 없이 정확하게 스트리밍되는지 확인하는 데 중점을 둡니다.

## 2. 테스트 환경 설정

### 2.1. 개발 환경

*   **백엔드**: Python 3.9+ (gRPCio, gRPCio-tools 설치)
*   **프론트엔드**: Node.js 20.x+ (gRPC-Web, gRPC-tools 설치)
*   **gRPC 프록시 (필요 시)**: Envoy 또는 gRPC-Web Proxy (브라우저 호환성을 위해)

### 2.2. 필요 도구

*   **`protoc` 컴파일러**: `.proto` 파일로부터 언어별 스텁 코드 생성
*   **`grpcurl`**: CLI 기반 gRPC 서비스 호출 및 테스트
*   **Postman / Insomnia**: gRPC 요청 테스트 (최신 버전 지원)
*   **브라우저 개발자 도구**: 네트워크 탭에서 gRPC-Web 통신 확인

## 3. 테스트 전략 및 진행 방향

테스트는 주로 통합 테스트와 종단간(E2E) 테스트에 초점을 맞춥니다.

### 3.1. 단위 테스트 (Unit Test)

*   **목표**: 각 gRPC 서비스 메서드의 개별 로직이 올바르게 작동하는지 확인합니다.
*   **진행 방향**: 
    *   백엔드 gRPC 서비스 구현 시, 각 스트리밍 메서드(예: `StreamGameState`, `StreamTrainingMetrics`)가 올바른 데이터를 생성하고 스트리밍하는지 모의(mock) 클라이언트를 사용하여 테스트합니다.
    *   프론트엔드 gRPC 클라이언트 구현 시, 수신된 데이터를 파싱하고 상태를 업데이트하는 로직이 올바른지 모의 서버를 사용하여 테스트합니다.

### 3.2. 통합 테스트 (Integration Test)

*   **목표**: 백엔드 gRPC 서버와 프론트엔드 gRPC 클라이언트 간의 통신이 명세에 따라 정확하게 이루어지는지 검증합니다.
*   **진행 방향**:
    *   **게임 상태 스트리밍**:
        *   프론트엔드 `HUD` 컴포넌트가 백엔드 gRPC 게임 서비스에 연결하여 게임 상태(`GameState`)를 실시간으로 수신하는지 확인합니다.
        *   체력 바, 슈퍼 게이지, 타이머 등 UI 요소가 수신된 데이터에 따라 올바르게 업데이트되는지 확인합니다.
        *   매치 종료 시 `match_end` 이벤트(또는 gRPC 스트림 종료)가 올바르게 처리되고 결과 화면으로 전환되는지 확인합니다.
    *   **학습 메트릭 스트리밍**:
        *   프론트엔드 `TrainingMode` 컴포넌트가 백엔드 gRPC 학습 서비스에 연결하여 학습 메트릭(`TrainingMetrics`)을 실시간으로 수신하는지 확인합니다.
        *   Loss, Reward 등 학습 메트릭 UI가 수신된 데이터에 따라 올바르게 업데이트되는지 확인합니다.
        *   학습 종료 시 `training_end` 이벤트(또는 gRPC 스트림 종료)가 올바르게 처리되는지 확인합니다.

### 3.3. 종단간(End-to-End) 테스트

*   **목표**: 실제 사용자 시나리오에 따라 전체 시스템이 gRPC 통신을 통해 원활하게 작동하는지 검증합니다.
*   **진행 방향**:
    *   프론트엔드 애플리케이션을 실행하고, 캐릭터 선택 후 대전 모드에 진입하여 실시간 게임 상태가 정상적으로 표시되는지 확인합니다.
    *   훈련 모드에 진입하여 학습 메트릭이 실시간으로 업데이트되는지 확인합니다.
    *   네트워크 지연 및 부하 상황을 시뮬레이션하여 gRPC 스트리밍의 안정성을 테스트합니다.

## 4. 성공 판단 기준

다음 조건들이 모두 충족될 경우, gRPC 통합이 성공적으로 완료된 것으로 판단합니다.

1.  **정확성**:
    *   `.proto` 파일에 정의된 메시지 및 서비스가 백엔드와 프론트엔드 간에 정확하게 매핑되고 통신됩니다.
    *   게임 상태(`GameState`) 및 학습 메트릭(`TrainingMetrics`) 데이터가 백엔드에서 프론트엔드로 손실 없이, 올바른 형식으로 전송됩니다.
    *   프론트엔드 UI가 수신된 gRPC 스트림 데이터에 따라 정확하게 업데이트됩니다.
2.  **안정성**:
    *   gRPC 스트리밍 연결이 장시간 유지되며, 비정상적인 종료 없이 안정적으로 데이터를 전송합니다.
    *   네트워크 불안정 상황(예: 일시적인 연결 끊김)에서도 클라이언트가 재연결을 시도하거나 적절히 오류를 처리합니다.
    *   백엔드 gRPC 서버가 과도한 부하 없이 여러 클라이언트 연결을 처리할 수 있습니다.
3.  **성능**:
    *   실시간 게임 상태 업데이트 시 눈에 띄는 지연(lag)이나 버벅임이 느껴지지 않습니다. (예: 100ms 이내의 지연)
    *   학습 메트릭 업데이트가 실시간으로 원활하게 이루어집니다.
4.  **오류 처리**:
    *   gRPC 통신 중 발생하는 오류(예: 서버 오류, 네트워크 오류)가 클라이언트와 서버 양쪽에서 적절히 로깅되고 처리됩니다.
    *   클라이언트가 서버로부터 유효하지 않은 데이터를 수신했을 때 시스템이 불안정해지지 않습니다.

## 5. 이슈 관리

*   테스트 과정에서 발견되는 모든 결함(Bug) 및 이슈는 GitHub Issues에 등록하여 추적하고 관리합니다.
*   각 이슈에는 재현 단계, 기대 결과, 실제 결과, 관련 로그 및 스크린샷을 포함하여 명확하게 기록합니다.
