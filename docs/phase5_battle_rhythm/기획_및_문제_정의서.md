# '전투의 리듬' 지표 도입 기획 및 문제 정의서

## 1. 문제 정의

### 1.1. 현재 AI 학습의 한계
현재 AI는 특정 시점의 게임 상태(캐릭터 위치, 체력 등)를 기반으로 최적의 행동을 선택하도록 학습하고 있다. 이는 강력한 반응성을 보이지만, 시간의 흐름 속에서 나타나는 상대방의 의도나 플레이 패턴, 즉 '흐름'을 이해하는 데에는 명백한 한계가 있다. Pose Estimation에서 추출된 고차원 데이터를 직접 학습하는 것은 비효율적이며, AI가 인간과 같은 고차원적인 전략을 구사하기 어렵게 만든다.

### 1.2. 플레이 스타일 분석의 객관성 부재
'공격적', '수비적', '예측하기 어려운' 등 플레이어의 스타일을 표현하는 언어는 모두 주관적이다. 플레이어의 실력을 향상시키거나 AI의 특징을 정의하기 위해선, 이러한 스타일을 누구나 동의할 수 있는 객관적이고 정량적인 '지표'로 변환할 필요가 있다.

### 1.3. '심리전' 구현의 어려움
격투 게임의 정수는 상대의 리듬을 파악하고, 그것을 의도적으로 깨뜨려 빈틈을 만드는 '심리전'에 있다. 현재 시스템에서는 AI가 이러한 심리전을 구사하거나 학습할 방법이 없다. AI는 단순히 최적의 수를 둘 뿐, 상대를 혼란시키기 위해 의도적으로 변칙적인 플레이를 섞는 등의 고등 전략을 구사할 수 없다.

## 2. 제안: '전투의 리듬' 지표 도입

### 2.1. 핵심 아이디어
플레이어의 모든 행동(공격, 방어, 이동 등)과 그 행동 사이의 시간 간격을 '음표'와 '쉼표'로 간주하여, 일련의 행동 시퀀스를 하나의 '악보(Score)'로 해석한다. 이 '악보'를 정량적으로 분석하여 플레이어의 고유한 '전투 리듬'을 추출하고, 이를 AI 학습과 플레이어 분석에 활용 가능한 핵심 '지표(Metric)'로 삼는다.

### 2.2. 왜 '전투의 리듬'인가?
- **차원 축소 및 특징 추출**: 수많은 관절 좌표(고차원)를 [펀치, 0.2초 쉼, 가드]와 같은 의미 있는 행동 시계열 데이터(저차원)로 변환하여 AI가 전략적 맥락을 훨씬 효율적으로 학습하게 한다.
- **심리전의 정량화**: 플레이 스타일의 변화무쌍함과 예측 불가능성을 '리듬 엔트로피'와 같은 지표로 측정하여 심리전의 개념을 AI가 이해하고 구사할 수 있는 영역으로 가져온다.
- **강력한 분석 도구**: 플레이어와 AI의 '리듬 악보'를 시각적으로 비교 분석함으로써, 패턴의 강점과 약점을 직관적으로 파악하고 실력 향상을 위한 구체적인 피드백을 제공할 수 있다.

## 3. 정량적 지표 설계

플레이어의 행동 로그(Action, Timestamp)를 기반으로 다음 지표들을 계산한다.

### 3.1. 기본 리듬 지표 (Basic Rhythm Metrics)
- **APM (Actions Per Minute)**: 1분당 평균 행동 수. 플레이어의 전반적인 활성도를 나타낸다.
- **행동 밀도 (Action Density)**: 특정 시간(예: 5초) 동안의 행동 수. 순간적인 공방의 치열함을 측정한다.

### 3.2. 공격 성향 지표 (Aggressiveness Metrics)
- **공격/방어 비율 (Offense/Defense Ratio)**: 전체 행동 중 공격 행동과 방어 행동의 비율. 1보다 크면 공격적, 작으면 방어적 성향을 의미한다.
- **선제공격률 (First Strike Rate)**: 중립 상황 이후 먼저 공격을 시도한 비율. 주도권 장악 성향을 보여준다.

### 3.3. 예측가능성 지표 (Predictability Metrics)
- **리듬 엔트로피 (Rhythm Entropy)**: 행동 시퀀스의 불확실성. 다양한 행동을 예측 불가능한 순서로 사용할수록 높아진다. **심리전의 핵심 지표**이다.
- **행동 반복 주기 (Action Recurrence Interval)**: 특정 행동을 다시 사용하기까지 걸리는 평균 시간. 특정 기술에 대한 의존도를 파악할 수 있다.

### 3.4. 지표 활용 예시
| 지표 (Metric) | 플레이어 A (돌격형) | 플레이어 B (운영형) |
| :--- | :--- | :--- |
| APM | 250 | 150 |
| 공격/방어 비율 | 3.2 (공격적) | 0.8 (방어적) |
| 선제공격률 | 75% | 30% |
| 리듬 엔트로피 | 0.6 (패턴 단순) | 0.9 (예측 불가능) |

## 4. 단계별 구현 계획

### 4.1. 1단계: 백엔드 - `RhythmAnalyzer` 모듈 개발
- **목표**: 실시간으로 플레이어의 행동 로그를 받아 '전투 리듬' 지표를 계산하는 Python 모듈 개발.
- **위치**: `phase5_battle_rhythm/src/rhythm_analyzer.py`
- **기능**:
    1. 행동 및 프레임 정보를 수신하는 `add_action` 메서드.
    2. 위 3절에서 정의된 모든 지표를 계산하는 `get_metrics` 메서드.
    3. 계산된 지표를 AI 학습에 사용될 숫자 벡터(Numpy 배열)로 변환하는 `get_feature_vector` 메서드.

### 4.2. 2단계: AI - 강화학습 환경(`FightingEnv`) 통합
- **목표**: `RhythmAnalyzer`에서 계산된 지표를 AI의 관측(Observation) 데이터에 포함시켜, AI가 리듬을 이해하고 학습하게 만든다.
- **수정 대상**: `src/fighting_env.py`, `train_rl_agent.py`
- **작업 내용**:
    1. `FightingEnv`의 `reset` 및 `step` 메서드에서 각 플레이어의 `RhythmAnalyzer`를 업데이트.
    2. `FightingEnv`의 `get_observation` 메서드가 반환하는 관측 데이터에 `RhythmAnalyzer`의 특징 벡터를 추가.
    3. Observation Space의 차원을 확장된 데이터에 맞게 수정.
    4. (선택) 리듬 엔트로피와 같은 특정 지표를 보상(Reward) 함수에 통합하여 AI의 행동을 유도 (예: 예측 불가능한 플레이에 추가 보상).

### 4.3. 3단계: 프론트엔드 - `BattleRhythmVisualizer` 개발
- **목표**: 경기 리플레이나 분석 모드에서 '전투 리듬'을 시각적으로 표현하는 UI 컴포넌트 개발.
- **위치**: `arcade-clash/components/BattleRhythmVisualizer.tsx`
- **기능**:
    1. 백엔드로부터 경기 로그 또는 계산된 리듬 데이터를 수신.
    2. 가로축은 시간, 세로축은 행동 종류로 하여 피아노 롤 또는 타임라인 형태로 시각화.
    3. 양 플레이어의 리듬을 겹쳐서 비교 분석할 수 있는 기능 제공.
    4. `AnalysisMode.tsx`와 같은 기존 분석 페이지에 통합.

## 5. 기대 효과

### 5.1. AI 지능의 고도화
단순 반응형 AI를 넘어, 상대의 패턴을 예측하고 의도적으로 자신의 리듬을 바꿔 상대를 교란하는 등, 인간과 유사한 '전략적' AI 구현이 가능해진다.

### 5.2. 새로운 차원의 분석 도구 제공
플레이어는 자신의 플레이 스타일을 객관적인 데이터로 확인하고, 고수들의 리듬 패턴을 학습하며, 상대의 습관을 간파하는 등 과학적인 실력 향상을 도모할 수 있다.

### 5.3. 게임의 깊이와 전문성 강화
'전투의 리듬'은 이 게임의 핵심적인 공략 요소가 되어, 유저와 AI 모두에게 더 깊은 수준의 전략적 재미와 전문성을 제공할 것이다. 이는 단순한 격투 게임을 넘어 e-스포츠로서의 잠재력을 극대화하는 요소가 될 것이다.
