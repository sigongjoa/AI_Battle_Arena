# '전투의 리듬' 기능 테스트 계획 및 성공 기준

## 1. 개요
이 문서는 '전투의 리듬' 기능이 프로젝트의 품질 기준을 만족하는지 검증하기 위한 테스트 계획과, 개발의 완료 및 성공을 판단하는 명확한 기준을 정의한다. 모든 테스트 활동과 성공 판단은 `프로젝트_가이드라인.md`에 명시된 '완료의 정의(Definition of Done, DoD)'를 기반으로 한다.

---

## 2. 테스트 환경 및 도구

-   **Python (Backend & Core Logic)**
    -   **프레임워크**: `pytest`
    -   **도구**:
        -   `pytest-cov`: 테스트 커버리지 측정을 통해 테스트가 누락된 코드가 없는지 확인한다.
        -   `stable-baselines3.common.env_checker`: 수정된 `FightingEnv`가 Gym 환경의 표준 인터페이스를 준수하는지 검증한다.

-   **TypeScript/React (Frontend)**
    -   **프레임워크**: `vitest`
    -   **라이브러리**: `@testing-library/react`를 사용하여 컴포넌트의 렌더링과 상호작용을 테스트한다.

-   **End-to-End (E2E) 테스트**
    -   자동화 도구 대신, 명확한 시나리오에 기반한 **수동 테스트**를 진행하여 최종 사용자 관점의 흐름을 검증한다.

---

## 3. 테스트 유형 및 절차

### 3.1. 단위 테스트 (Unit Tests)
-   **목표**: 각 모듈이 독립적으로 정확하게 동작하는지 검증한다.
-   **대상 1: `src/rhythm_analyzer.py`**
    -   `test_add_action`: 고정된 크기의 윈도우(`window_size`)가 잘 유지되는지, 액션이 정확히 기록되는지 테스트한다.
    -   `test_get_metrics_calculation`: 미리 정의된 행동 시퀀스를 입력했을 때, `apm`, `offense_defense_ratio`, `rhythm_entropy` 등의 지표가 예상된 값으로 정확히 계산되는지 검증한다. (예: 모든 액션이 같을 때 엔트로피는 0이 되어야 한다.)
    -   `test_edge_cases`: 행동 로그가 비어있을 때, 또는 단 하나의 행동만 있을 때 에러 없이 기본값을 올바르게 반환하는지 테스트한다.

### 3.2. 통합 테스트 (Integration Tests)
-   **목표**: 여러 모듈이 함께 연동될 때 발생하는 문제를 검증한다.
-   **대상: `GameRunner` + `FightingEnv` + `RhythmAnalyzer`**
    -   `test_observation_space_expansion`: `RhythmAnalyzer`가 통합된 `FightingEnv`의 `observation_space` 크기가 명세서대로 (기존 space + 리듬 벡터 크기) 올바르게 확장되었는지 확인한다.
    -   `test_enriched_observation_flow`: `GameRunner`를 통해 몇 프레임의 게임을 실행시킨 후, AI의 `model.predict()`에 전달되는 관측 데이터(`enriched_obs`)가 리듬 분석 지표를 실제로 포함하고 있는지, 그 값들이 0이 아닌 유의미한 값인지 검증한다.

### 3.3. 프론트엔드 컴포넌트 테스트
-   **목표**: UI 컴포넌트가 주어진 데이터에 따라 정확하게 렌더링되는지 검증한다.
-   **대상: `arcade-clash/components/BattleRhythmVisualizer.tsx`**
    -   `test_visualizer_render`: Mock으로 만든 `ActionLogItem` 배열을 props로 전달했을 때, 타임라인 위에 해당 액션들이 막대 그래프 형태로 정상적으로 렌더링되는지 확인한다.
    -   `test_visualizer_interaction`: 렌더링된 액션 막대 위에 마우스를 올렸을 때, 해당 액션의 상세 정보(이름, 프레임 등)가 담긴 툴팁이 나타나는지 테스트한다.

---

## 4. 성공 판단 기준 (DoD 기반)

'전투의 리듬' 기능 개발의 **최종 성공**은 아래의 '완료의 정의(DoD)' 체크리스트를 모두 만족하는 것으로 판단한다.

### ✅ 완료의 정의 (Definition of Done) 체크리스트

1.  **[ ] 코드 작성 완료**
    -   기능 명세서에 정의된 모든 요구사항이 코드로 구현되었는가?

2.  **[ ] 테스트 통과**
    -   위 3절에서 정의된 모든 단위/통합/컴포넌트 테스트가 100% 통과했는가?
    -   `pytest-cov`로 측정한 `src/rhythm_analyzer.py`의 테스트 커버리지가 **95% 이상**인가?

3.  **[ ] 코딩 컨벤션 준수**
    -   `Black`, `isort`, `Flake8` (Python) 및 `ESLint`, `Prettier` (TypeScript) 검사를 모두 통과했는가?

4.  **[ ] 문서 최신화**
    -   구현 과정에서 변경된 사항이 있다면, `기술_명세서.md` 등 모든 관련 문서에 반영되었는가?

5.  **[ ] 코드 리뷰**
    -   작성된 코드 전체에 대해 동료의 코드 리뷰를 받고, 제기된 이슈들을 모두 해결하여 승인(Approve)을 받았는가?

6.  **[ ] E2E 시나리오 검증**
    -   로컬 환경에서 서버를 구동하고, 두 명의 플레이어로 P2P 대전을 진행한 후, 분석 페이지에서 해당 경기의 '전투 리듬'이 정상적으로 시각화되는 것을 수동으로 확인했는가?

7.  **[ ] `main` 브랜치 머지**
    -   위 모든 과정을 통과한 기능 브랜치가 `main` 브랜치에 충돌 없이 성공적으로 머지(Merge)되었는가?
