# Phase 8: AI 페르소나 실험 기술 명세서

## 1. 시스템 아키텍처 개요
Phase 8의 AI 페르소나 실험 시스템은 `Phase 7`에서 구축된 AI 기반 QA 파이프라인을 확장하여, 다양한 AI 페르소나를 학습, 시뮬레이션 및 분석하는 데 중점을 둡니다. 기존 모듈들을 재활용하고 확장하여 효율적인 페르소나 관리 및 실험 환경을 제공합니다.

```mermaid
graph TD
    subgraph "Phase 7 Core Components"
        A[Simulation Arena<br>(Human Error Layer, Network Sim)];
        B[Log Collector];
        C[Metric Extractor];
        D[DB Manager];
    end

    subgraph "Phase 8 Extensions"
        E[AI Persona Manager<br>(Persona Definitions, Model Storage)];
        F[RL Agent Trainer<br>(Stable-Baselines3, Custom Rewards)];
        G[Multi-Persona Experiment Orchestrator<br>(Match Scheduling, Data Aggregation)];
        H[Persona Analysis & Comparison Module];
    end

    subgraph "Reporting"
        I[Report Generator];
    end

    A -- "Game State, Action" --> B;
    B -- "Log Files (.jsonl.gz)" --> C;
    C -- "Metrics" --> D;
    D -- "Metrics Data" --> H;
    E -- "Persona Config" --> F;
    F -- "Trained Persona Models" --> G;
    G -- "Simulate Matches" --> A;
    G -- "Match Results" --> B;
    H -- "Analysis Results" --> I;
    I -- "Reports (.md, Video)" --> User;
```

## 2. 컴포넌트별 기술 명세

### 2.1. AI Persona Manager (`src/qa_evaluator/ai_personas.py` 확장)
*   **역할:** 각 AI 페르소나의 정의(이름, 설명, 보상 가중치, 훈련 파라미터, 에러 허용치 등)를 관리합니다.
*   **기술:** Python 클래스 및 딕셔너리 구조를 활용하여 페르소나 객체를 정의하고 접근합니다. `Phase 7`의 `ai_personas.py`를 직접 활용합니다.
*   **확장:** 각 페르소나별로 고유한 `Action Masking` 규칙이나 `Custom Reward` 함수를 동적으로 로드할 수 있는 구조를 고려합니다.

### 2.2. RL Agent Trainer (`src/qa_evaluator/mock_rl_trainer.py` 확장)
*   **역할:** `Stable-Baselines3` 라이브러리를 활용하여 각 AI 페르소나에 맞는 RL 에이전트를 학습시킵니다.
*   **기술:** `Stable-Baselines3`의 `PPO` 알고리즘을 기본으로 사용하며, `ai_personas.py`에 정의된 `training_params`를 적용합니다.
*   **확장:**
    *   **Custom Reward Function Integration:** 각 페르소나의 `reward_weights`를 기반으로 게임 환경의 보상 함수를 동적으로 구성하는 로직을 구현합니다.
    *   **Action Masking Integration:** `초보자 AI`와 같이 특정 액션을 제한해야 하는 경우, 환경의 `action_space`에 마스킹을 적용하는 로직을 구현합니다.
    *   **Curiosity-Driven Exploration:** `Stable-Baselines3-Contrib`의 `ICM` (Intrinsic Curiosity Module)을 선택적으로 통합하여 에이전트의 탐색 능력을 강화합니다.

### 2.3. Multi-Persona Experiment Orchestrator (신규 모듈)
*   **역할:** 정의된 AI 페르소나들을 조합하여 대전 시뮬레이션을 스케줄링하고 실행을 조율합니다.
*   **기술:** Python 스크립트로 구현되며, `RL Agent Trainer`를 통해 학습된 페르소나 모델들을 로드하여 `Simulation Arena`에 투입합니다. `Phase 7`의 `mock_multi_persona_analyzer.py`를 실제 오케스트레이터로 발전시킵니다.
*   **주요 기능:**
    *   **대전 스케줄링:** 모든 페르소나 쌍에 대한 대전 또는 특정 페르소나 간의 반복 대전 설정.
    *   **시뮬레이션 실행:** 각 대전마다 `Simulation Arena`를 초기화하고, `Human Error Layer` 및 `Network Simulator` 파라미터를 페르소나 설정에 따라 동적으로 조정하여 실행.
    *   **데이터 수집:** `Log Collector`를 통해 생성된 로그 파일 및 리플레이 데이터를 관리.

### 2.4. Persona Analysis & Comparison Module (신규 모듈)
*   **역할:** `Multi-Persona Experiment Orchestrator`를 통해 수집된 데이터를 기반으로 각 페르소나의 플레이 특성 및 페르소나 간의 비교 분석을 수행합니다.
*   **기술:** `Phase 7`의 `Metric Extractor`를 활용하여 로그 파일에서 메트릭을 추출하고, `DB Manager`에 저장된 메트릭을 쿼리하여 분석합니다. `Phase 7`의 `mock_multi_persona_analyzer.py`의 분석 로직을 실제 구현합니다.
*   **주요 기능:**
    *   **페르소나별 메트릭 집계:** 각 페르소나의 시뮬레이션 세션에서 추출된 QA 및 Immersion 메트릭을 집계하고 평균, 표준편차 등을 계산.
    *   **비교 분석:** 페르소나 간의 승률, 데미지 효율, 실수율, 특정 액션 사용 빈도 등을 비교하여 차이점 분석.
    *   **특정 패턴 탐지:** `프로게이머 AI`의 버그성 플레이, `초보자 AI`의 막히는 구간, `트롤 AI`의 어뷰징 패턴 등을 메트릭과 로그 분석을 통해 탐지.

### 2.5. 기존 Phase 7 컴포넌트 활용 및 확장
*   **Simulation Arena:** `Human Error Layer`의 파라미터(`reaction_time_mean`, `mistake_probability`, `drop_probability`)를 각 페르소나의 `error_tolerance`에 따라 동적으로 설정하여 활용.
*   **Log Collector:** `Phase 7`에서 구현된 로깅 시스템을 그대로 활용하여 모든 페르소나 실험 데이터를 수집.
*   **Metric Extractor:** `Phase 7`에서 구현된 메트릭 추출 로직을 활용하여 페르소나별 플레이 데이터를 분석.
*   **DB Manager:** `Phase 7`에서 구축된 데이터베이스 스키마를 활용하여 페르소나 실험 결과 및 분석 데이터를 저장.

## 3. 데이터 명세 (확장)
*   **페르소나 정의:** `ai_personas.py`에 Python 딕셔너리 형태로 정의.
*   **학습된 모델:** `models/` 디렉토리에 `Stable-Baselines3` 모델 파일(`.zip`) 형태로 저장.
*   **실험 결과:** `metrics.db`에 `sessions`, `qa_metrics`, `immersion_metrics` 테이블에 저장되며, `session_id`를 통해 각 페르소나의 실험 결과임을 식별 가능.

## 4. 개발 및 운영 환경
`Phase 7`과 동일한 환경을 유지합니다.
*   **프로그래밍 언어:** `Python 3.10+`
*   **가상 환경:** `venv` 또는 `Conda`
*   **의존성 관리:** `pip`와 `requirements.txt`.
*   **버전 관리:** `Git`, `GitHub`.
*   **운영체제:** `Linux (Ubuntu 22.04)`
